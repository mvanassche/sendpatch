<!-- <xml version="1.0"> -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
  <meta name="generator" content=
  "HTML Tidy for Cygwin (vers 1st September 2004), see www.w3.org" />

  <title>Submit patches</title><!-- 2013-10-11 Fri 10:25 -->
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="generator" content="Org-mode" />
  <meta name="author" content="Fabrice Niessen" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"
type="text/javascript">
</script>
  <link rel="stylesheet" type="text/css" href=
  "http://svn/mc/xxx/org-style/trunk/bigblow/css/bigblow.css" />
  <link rel="stylesheet" type="text/css" href=
  "http://svn/mc/xxx/org-style/trunk/bigblow/css/htmlize.css" />
<script type="text/javascript" src=
"http://svn/mc/xxx/org-style/trunk/bigblow/js/bigblow.js">
</script>
  <link rel="stylesheet" type="text/css" href="css/bigblow.css" />
  <link rel="stylesheet" type="text/css" href="css/htmlize.css" />
<script type="text/javascript" src="js/bigblow.js">
</script>
</head>

<body>
  <div id="content">
    <h1 class="title">Submit patches</h1>

    <div id="outline-container-sec-1" class="outline-2">
      <h2 id="sec-1"><span class="section-number-2">1</span> Commit
      guidelines</h2>

      <div class="outline-text-2" id="text-1">
        <p>This list hopes to help all of us to improve our commits.</p>
      </div>

      <div id="outline-container-sec-1-1" class="outline-3">
        <h3 id="sec-1-1"><span class="section-number-3">1.1</span> Changes</h3>

        <div class="outline-text-3" id="text-1-1">
          <ul class="org-ul">
            <li>Make commits of logical units.</li>

            <li>Check for unnecessary whitespace before committing.</li>

            <li>Do not check in commented out code or unneeded files.</li>

            <li>Make sure that you have tests for the bug you are fixing.</li>

            <li>Make sure that the test suite passes after your commit.</li>

            <li>Do not attach your patch, but submit it “inline” in the mail
            body, <i>unless you cannot teach your mailer to leave the
            formatting of the patch alone</i>.</li>
          </ul>
        </div>
      </div>

      <div id="outline-container-sec-1-2" class="outline-3">
        <h3 id="sec-1-2"><span class="section-number-3">1.2</span> Commit
        messages</h3>

        <div class="outline-text-3" id="text-1-2">
          <ul class="org-ul">
            <li>The first line of the commit message should be a short
            description (50&nbsp;characters is the <i>soft</i> limit), and
            should <b>skip the full stop</b>.</li>

            <li>The body should provide a meaningful commit message, which:

              <ul class="org-ul">
                <li>uses the <b>imperative present tense</b>: “fix bug”, not
                “fixed bug” or “fixes bug”.</li>

                <li>includes motivation for the change, and contrasts its
                implementation with previous behavior.</li>
              </ul>
            </li>
          </ul>

          <p>Keep in mind that commit messages are often read <b>without</b>
          seeing the diffs, and without the possibility to see which other
          files you committed just before that particular commit!</p>
        </div>
      </div>

      <div id="outline-container-sec-1-3" class="outline-3">
        <h3 id="sec-1-3"><span class="section-number-3">1.3</span> Release
        notes</h3>

        <div class="outline-text-3" id="text-1-3">
          <p>We have introduced the possibility to insert release notes in log
          messages. In order to make them stand out, all such notes must be
          enclosed in a <code>#+begin_releasenotes</code> ..
          <code>#end_releasenotes</code> block.</p>
        </div>
      </div>

      <div id="outline-container-sec-1-4" class="outline-3">
        <h3 id="sec-1-4"><span class="section-number-3">1.4</span> Example</h3>

        <div class="outline-text-3" id="text-1-4">
          <div class="org-src-container">
            <pre class="src src-text">
Short summary of changes

More detailed explanatory text, if necessary. Wrap it to about 72 characters
or so. In some contexts, the first line is treated as the subject of an email
and the rest of the text as the body. The blank line separating the summary
from the body is critical; some tools can get confused if you run the two
together.

Further paragraphs come after blank lines.

- Bullet points are okay, too

- Typically a hyphen is used for the bullet, with blank lines in between, but
  conventions vary here

- Use a hanging indent
</pre>
          </div>
        </div>
      </div>
    </div>

    <div id="outline-container-sec-2" class="outline-2">
      <h2 id="sec-2"><span class="section-number-2">2</span> Code</h2>

      <div class="outline-text-2" id="text-2"></div>

      <div id="outline-container-sec-2-1" class="outline-3">
        <h3 id="sec-2-1"><span class="section-number-3">2.1</span> Send
        patch</h3>

        <div class="outline-text-3" id="text-2-1">
          <p>This script sends patches:</p>

          <ul class="org-ul">
            <li>to the SVN repository (that is, <i>commits</i> them)</li>

            <li>to mailing lists (that is, <i>emails</i> them)</li>
          </ul>
        </div>

        <div id="outline-container-sec-2-1-1" class="outline-4">
          <h4 id="sec-2-1-1"><span class="section-number-4">2.1.1</span>
          Version number</h4>

          <div class="outline-text-4" id="text-2-1-1">
            <div class="org-src-container">
              <pre class="src src-sh" id="time-stamp">
<span style="color: #006FE0;">echo</span> <span style=
"color: #FF4700;">"$(date '+%Y%m%d.%H%M')"</span>
</pre>
            </div>

            <div class="org-src-container">
              <pre class="src src-sh">
    cat &lt;&lt; EOF
<span style=
"color: #0000ff; background-color: #EEF5FE;">This is $(basename $0), version: 20131011.1025.</span>

<span style="color: #0000ff; background-color: #EEF5FE;">EOF</span>
</pre>
            </div>
          </div>
        </div>

        <div id="outline-container-sec-2-1-2" class="outline-4">
          <h4 id="sec-2-1-2"><span class="section-number-4">2.1.2</span>
          Usage</h4>

          <div class="outline-text-4" id="text-2-1-2">
            <div class="org-src-container">
              <pre class="src src-sh">
<span style="color: #006699;">Usage</span> ()
{
    cat &lt;&lt; EOF 1&gt;&amp;2
<span style=
"color: #0000ff; background-color: #EEF5FE;">Usage: $(basename $0) [OPTION]... [FILE]...</span>
<span style=
"color: #0000ff; background-color: #EEF5FE;">Submit patches per email.</span>

<span style=
"color: #0000ff; background-color: #EEF5FE;">  -h, --help                display this help and exit</span>

<span style=
"color: #0000ff; background-color: #EEF5FE;">Report $(basename $0) bugs to fni@xxx.com</span>
<span style=
"color: #0000ff; background-color: #EEF5FE;">Commit guidelines: <a href=
"http://svn/mc/xxx/sendpatch/trunk/send-patch.html">&lt;http://svn/mc/xxx/sendpatch/trunk/send-patch.html&gt;</a></span>
<span style="color: #0000ff; background-color: #EEF5FE;">EOF</span>
    <span style="color: #0000FF;">exit</span> 1
}

<span style="color: #0000FF;">while </span><span style=
"color: #006FE0;">true</span>; <span style="color: #0000FF;">do</span>
    <span style="color: #0000FF;">case</span> <span style=
"color: #FF4700;">"$1"</span><span style="color: #0000FF;"> in</span>
        -h | --help) Usage; <span style="color: #006FE0;">shift</span> ;;
        * ) <span style="color: #0000FF;">break</span> ;;
    <span style="color: #0000FF;">esac</span>
<span style="color: #0000FF;">done</span>
<span style="color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">now do something with $@</span>
</pre>
            </div>
          </div>
        </div>

        <div id="outline-container-sec-2-1-3" class="outline-4">
          <h4 id="sec-2-1-3"><span class="section-number-4">2.1.3</span>
          Configuration</h4>

          <div class="outline-text-4" id="text-2-1-3"></div>

          <div id="outline-container-sec-2-1-3-1" class="outline-5">
            <h5 id="sec-2-1-3-1">Per project options</h5>

            <div class="outline-text-5" id="text-2-1-3-1">
              <div class="org-src-container">
                <pre class="src src-sh">
<span style="color: #BA36A5;">mailto</span>=<span style=
"color: #FF4700;">"mc-reviews@xxx.com"</span>
<span style="color: #BA36A5;">prefix</span>=<span style=
"color: #FF4700;">"[PATCH]"</span>
<span style="color: #BA36A5;">excludefileregexp</span>=<span style=
"color: #FF4700;">""</span>
</pre>
              </div>
            </div>
          </div>

          <div id="outline-container-sec-2-1-3-2" class="outline-5">
            <h5 id="sec-2-1-3-2">Per user options</h5>

            <div class="outline-text-5" id="text-2-1-3-2">
              <div class="org-src-container">
                <pre class="src src-sh">
<span style="color: #BA36A5;">patchfileprefix</span>=<span style=
"color: #FF4700;">""</span>
<span style="color: #BA36A5;">commitmsgfileprefix</span>=<span style=
"color: #FF4700;">""</span>
<span style="color: #BA36A5;">emailfileprefix</span>=<span style=
"color: #FF4700;">""</span>
<span style="color: #BA36A5;">asksubject</span>=<span style=
"color: #FF4700;">"yes"</span>
<span style="color: #BA36A5;">autocommit</span>=<span style=
"color: #FF4700;">"ask"</span>
<span style="color: #BA36A5;">autosendemail</span>=<span style=
"color: #FF4700;">"ask"</span>
<span style="color: #BA36A5;">autodeletetmpfiles</span>=<span style=
"color: #FF4700;">"ask"</span>
<span style="color: #BA36A5;">emailcommand</span>=<span style=
"color: #FF4700;">'blat "$email" -to "$mailto" -subject "$prefix $subject" -server "mail" -f "John Doe <a href="mailto:johndoe%40example.com">&lt;johndoe@example.com&gt;</a>" -charset UTF-8'</span>
</pre>
              </div>
            </div>
          </div>

          <div id="outline-container-sec-2-1-3-3" class="outline-5">
            <h5 id="sec-2-1-3-3">Example</h5>

            <div class="outline-text-5" id="text-2-1-3-3">
              <p>A commonly configured option could be:</p>

              <div class="org-src-container">
                <pre class="src src-sh">
<span style="color: #BA36A5;">excludefileregexp</span>=<span style=
"color: #FF4700;">"(\\\.html|\\\.xml)"</span>
</pre>
              </div>

              <p>Note the use of <b>3 backslashes</b>!</p>
            </div>
          </div>

          <div id="outline-container-sec-2-1-3-4" class="outline-5">
            <h5 id="sec-2-1-3-4">Files</h5>

            <div class="outline-text-5" id="text-2-1-3-4">
              <p>All the <i>default</i> settings can be overridden in:</p>

              <ol class="org-ol">
                <li><code>~/.sendpatchrc</code></li>

                <li><code>sendpatch.common</code> in the root directory of a
                working copy</li>

                <li><code>sendpatch.params</code> in the root directory of a
                working copy</li>
              </ol>

              <p>in that order.</p>

              <p>Remember that those configuration files must be encoded with
              <b>Unix line endings</b>!</p>
            </div>
          </div>
        </div>

        <div id="outline-container-sec-2-1-4" class="outline-4">
          <h4 id="sec-2-1-4"><span class="section-number-4">2.1.4</span> Helper
          functions</h4>

          <div class="outline-text-4" id="text-2-1-4">
            <p>The exit status follows the conventions for programs such as
            <code>grep</code>, <code>cmp</code>, and <code>diff</code>:</p>

            <div class="org-src-container">
              <pre class="src src-sh">
<span style="color: #006699;">die</span> () {
    printf <span style=
"color: #FF4700;">"$(basename $0): $@\n"</span> &gt; /dev/stderr
    <span style="color: #0000FF;">exit</span> 2 <span style=
"color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">an </span><span style=
"color: #008200; background-color: #FFFF88; font-style: italic;">error</span><span style="color: #008200; font-style: italic;"> occurred</span>
}
</pre>
            </div>

            <div class="org-src-container">
              <pre class="src src-sh">
<span style="color: #006699;">cecho</span> () {
    <span style="color: #BA36A5;">black</span>=<span style=
"color: #FF4700;">"\e[30m"</span>
    <span style="color: #BA36A5;">red</span>=<span style=
"color: #FF4700;">"\e[31m"</span>
    <span style="color: #BA36A5;">green</span>=<span style=
"color: #FF4700;">"\e[32m"</span>
    <span style="color: #BA36A5;">yellow</span>=<span style=
"color: #FF4700;">"\e[33m"</span>
    <span style="color: #BA36A5;">blue</span>=<span style=
"color: #FF4700;">"\e[34m"</span>
    <span style="color: #BA36A5;">magenta</span>=<span style=
"color: #FF4700;">"\e[35m"</span>
    <span style="color: #BA36A5;">cyan</span>=<span style=
"color: #FF4700;">"\e[36m"</span>
    <span style="color: #BA36A5;">white</span>=<span style=
"color: #FF4700;">"\e[37m"</span>

    <span style="color: #BA36A5;">BLACK</span>=<span style=
"color: #FF4700;">"\e[1;30m"</span>
    <span style="color: #BA36A5;">RED</span>=<span style=
"color: #FF4700;">"\e[1;31m"</span>
    <span style="color: #BA36A5;">GREEN</span>=<span style=
"color: #FF4700;">"\e[1;32m"</span>
    <span style="color: #BA36A5;">YELLOW</span>=<span style=
"color: #FF4700;">"\e[1;33m"</span>
    <span style="color: #BA36A5;">BLUE</span>=<span style=
"color: #FF4700;">"\e[1;34m"</span>
    <span style="color: #BA36A5;">MAGENTA</span>=<span style=
"color: #FF4700;">"\e[1;35m"</span>
    <span style="color: #BA36A5;">CYAN</span>=<span style=
"color: #FF4700;">"\e[1;36m"</span>
    <span style="color: #BA36A5;">WHITE</span>=<span style=
"color: #FF4700;">"\e[1;37m"</span>

    <span style="color: #BA36A5;">reset</span>=<span style=
"color: #FF4700;">"\e[0m"</span>

    <span style="color: #BA36A5;">color</span>=${<span style=
"color: #BA36A5;">YELLOW</span>}
    printf <span style="color: #FF4700;">"$color$1$reset\n"</span>
}
</pre>
            </div>
          </div>

          <div id="outline-container-sec-2-1-4-1" class="outline-5">
            <h5 id="sec-2-1-4-1">VCS in use</h5>

            <div class="outline-text-5" id="text-2-1-4-1">
              <div class="org-src-container">
                <pre class="src src-sh">
<span style="color: #006699;">vcs_info</span> () {
    <span style="color: #006FE0;">local</span> <span style=
"color: #BA36A5;">default</span>=<span style="color: #FF4700;">"tfs"</span>

    <span style="color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">recursively search for `.svn' directory</span>
    <span style=
"color: #0000FF;">while</span> [[ ! ( -d .svn ) &amp;&amp; ( <span style=
"color: #FF4700;">"$(pwd)"</span> != <span style=
"color: #FF4700;">"/"</span> ) ]]; <span style="color: #0000FF;">do</span>
        <span style="color: #006FE0;">cd</span> ..
    <span style="color: #0000FF;">done</span>

    <span style="color: #0000FF;">if</span> [[ -d .svn ]]; <span style=
"color: #0000FF;">then</span>
        printf <span style="color: #FF4700;">"svn\n"</span>
    <span style="color: #0000FF;">else</span> <span style=
"color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">not found</span>
        printf <span style="color: #FF4700;">"$default\n"</span>
    <span style="color: #0000FF;">fi</span>
}
</pre>
              </div>
            </div>
          </div>

          <div id="outline-container-sec-2-1-4-2" class="outline-5">
            <h5 id="sec-2-1-4-2">TFS</h5>

            <div class="outline-text-5" id="text-2-1-4-2">
              <div class="org-src-container">
                <pre class="src src-sh">
<span style="color: #006699;">fixtfsbinaryfiles</span> () {
    sed -r <span style=
"color: #FF4700;">"s/^(.*): files differ$/Index: \1\n===================================================================\nCannot display: file marked as a binary type.\n===================================================================/"</span>
}
</pre>
              </div>
            </div>
          </div>

          <div id="outline-container-sec-2-1-4-3" class="outline-5">
            <h5 id="sec-2-1-4-3">Yes/No prompt function</h5>

            <div class="outline-text-5" id="text-2-1-4-3">
              <div class="org-src-container">
                <pre class="src src-sh">
<span style="color: #006699;">ask</span> () {
    <span style="color: #0000FF;">while </span><span style=
"color: #006FE0;">true</span>; <span style="color: #0000FF;">do</span>
        <span style="color: #0000FF;">if</span> [ <span style=
"color: #FF4700;">"${2:-}"</span> = <span style=
"color: #FF4700;">"Y"</span> ]; <span style="color: #0000FF;">then</span>
            <span style="color: #BA36A5;">prompt</span>=<span style=
"color: #FF4700;">"Y/n"</span>
            <span style="color: #BA36A5;">default</span>=Y
        <span style="color: #0000FF;">elif</span> [ <span style=
"color: #FF4700;">"${2:-}"</span> = <span style=
"color: #FF4700;">"N"</span> ]; <span style="color: #0000FF;">then</span>
            <span style="color: #BA36A5;">prompt</span>=<span style=
"color: #FF4700;">"y/N"</span>
            <span style="color: #BA36A5;">default</span>=N
        <span style="color: #0000FF;">else</span>
            <span style="color: #BA36A5;">prompt</span>=<span style=
"color: #FF4700;">"y/n"</span>
            <span style="color: #BA36A5;">default</span>=
        <span style="color: #0000FF;">fi</span>

        <span style="color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">ask the question (without the need to press RET)</span>
        printf <span style="color: #FF4700;">"$1 ($prompt): "</span>
        <span style="color: #006FE0;">read</span> -n 1 -r REPLY
        printf <span style="color: #FF4700;">"\n"</span> <span style=
"color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">just a final linefeed</span>

        <span style="color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">default?</span>
        <span style="color: #0000FF;">if</span> [ -z <span style=
"color: #FF4700;">"$REPLY"</span> ]; <span style="color: #0000FF;">then</span>
            <span style="color: #BA36A5;">REPLY</span>=$<span style=
"color: #BA36A5;">default</span>
        <span style="color: #0000FF;">fi</span>

        <span style="color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">check if the reply is valid</span>
        <span style="color: #0000FF;">case</span> <span style=
"color: #FF4700;">"$REPLY"</span><span style="color: #0000FF;"> in</span>
            y*|Y*) <span style="color: #0000FF;">return</span> 0 ;;
            n*|N*) <span style="color: #0000FF;">return</span> 1 ;;
        <span style="color: #0000FF;">esac</span>
    <span style="color: #0000FF;">done</span>
}
</pre>
              </div>

              <p>See <a href="https://gist.github.com/1965569">usage
              samples</a> for defaults (when the user presses <code>RET</code>
              without giving an answer).</p>

              <p>See <a href=
              "http://stackoverflow.com/questions/1885525/how-do-i-prompt-a-user-for-confirmation-in-bash-script">
              How do I prompt a user for confirmation in bash script?</a> for
              the regexp match operator =~.</p>
            </div>
          </div>
        </div>

        <div id="outline-container-sec-2-1-5" class="outline-4">
          <h4 id="sec-2-1-5"><span class="section-number-4">2.1.5</span>
          Init</h4>

          <div class="outline-text-4" id="text-2-1-5">
            <div class="org-src-container">
              <pre class="src src-sh">
<span style="color: #BA36A5;">tmpfile</span>=<span style=
"color: #FF4700;">"/tmp/$(basename $0).$$"</span>
<span style="color: #0000FF;">trap</span> <span style=
"color: #FF4700;">"rm -f $tmpfile"</span> EXIT SIGHUP SIGINT SIGQUIT SIGTERM

<span style="color: #BA36A5;">userconfig</span>=~/.sendpatchrc
<span style="color: #BA36A5;">projectconfig</span>=sendpatch.common
<span style="color: #BA36A5;">userprojectconfig</span>=sendpatch.params

<span style="color: #006FE0;">export</span> <span style=
"color: #BA36A5;">vcs</span>=$(vcs_info)
printf <span style="color: #FF4700;">"VC backend: $vcs\n"</span>

<span style="color: #0000FF;">case</span> $<span style=
"color: #BA36A5;">vcs</span><span style="color: #0000FF;"> in</span>
    svn)
        <span style="color: #BA36A5;">VCS_STATUS</span>=<span style=
"color: #FF4700;">"svn status --ignore-externals"</span>
        ;;
    tfs)
        <span style="color: #BA36A5;">VCS_STATUS</span>=<span style=
"color: #FF4700;">"tf status"</span>
        ;;
    *)
        die <span style="color: #FF4700;">"VCS backend is not supported"</span>
        ;;
<span style="color: #0000FF;">esac</span>
</pre>
            </div>
          </div>
        </div>

        <div id="outline-container-sec-2-1-6" class="outline-4">
          <h4 id="sec-2-1-6"><span class="section-number-4">2.1.6</span> Check
          current directory</h4>

          <div class="outline-text-4" id="text-2-1-6">
            <p>Note that, for TFS, we impose to find a
            <code>sendpatch.common</code> file in order to conclude that we’re
            at the root directory of a working copy, or not.</p>

            <div class="org-src-container">
              <pre class="src src-sh">
<span style="color: #0000FF;">case</span> $<span style=
"color: #BA36A5;">vcs</span><span style="color: #0000FF;"> in</span>
    svn)
        [[ -d .svn ]] <span style="color: #FF4700;">\</span>
            || die <span style=
"color: #FF4700;">"\`$(pwd)' is not the root directory of a working copy"</span>
        ;;
    tfs)
        [[ -f $<span style=
"color: #BA36A5;">projectconfig</span> ]] <span style=
"color: #FF4700;">\</span>
            || die <span style=
"color: #FF4700;">"\`$(pwd)' is not the root directory of a working copy"</span>
        ;;
<span style="color: #0000FF;">esac</span>
</pre>
            </div>
          </div>
        </div>

        <div id="outline-container-sec-2-1-7" class="outline-4">
          <h4 id="sec-2-1-7"><span class="section-number-4">2.1.7</span> Get
          URL of project</h4>

          <div class="outline-text-4" id="text-2-1-7">
            <div class="org-src-container">
              <pre class="src src-sh">
<span style="color: #0000FF;">case</span> $<span style=
"color: #BA36A5;">vcs</span><span style="color: #0000FF;"> in</span>
    svn)
        <span style=
"color: #BA36A5;">url</span>=$(svn info | grep -E <span style=
"color: #FF4700;">"^URL"</span>)/
        ;;
    tfs)
        <span style="color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">get collection and project</span>
        tf workfold &gt; $<span style="color: #BA36A5;">tmpfile</span>
        <span style="color: #BA36A5;">url</span>=$(cat $<span style=
"color: #BA36A5;">tmpfile</span> | grep -E <span style=
"color: #FF4700;">"^(Collection| \\$/)"</span> | sed <span style=
"color: #FF4700;">"/^ \\$/{s/:.*//}"</span>)
        ;;
<span style="color: #0000FF;">esac</span>
</pre>
            </div>
          </div>
        </div>

        <div id="outline-container-sec-2-1-8" class="outline-4">
          <h4 id="sec-2-1-8"><span class="section-number-4">2.1.8</span>
          Override settings</h4>

          <div class="outline-text-4" id="text-2-1-8">
            <div class="org-src-container">
              <pre class="src src-sh">
[[ -f $<span style=
"color: #BA36A5;">userconfig</span> ]] &amp;&amp; . $<span style=
"color: #BA36A5;">userconfig</span>
[[ -f $<span style=
"color: #BA36A5;">projectconfig</span> ]] &amp;&amp; . $<span style=
"color: #BA36A5;">projectconfig</span>
[[ -f $<span style=
"color: #BA36A5;">userprojectconfig</span> ]] &amp;&amp; . $<span style=
"color: #BA36A5;">userprojectconfig</span>
</pre>
            </div>

            <p>Default sender of the email is John Doe. If not configured
            otherwise, bail out:</p>

            <div class="org-src-container">
              <pre class="src src-sh">
printf <span style="color: #FF4700;">"$emailcommand"</span> | grep <span style=
"color: #FF4700;">"John Doe"</span> <span style="color: #FF4700;">\</span>
    &amp;&amp; die <span style=
"color: #FF4700;">"Please fix the sender address in the email command"</span>
</pre>
            </div>

            <p>Default editor is <code>$EDITOR</code>. If not found, set
            Emacs:</p>

            <div class="org-src-container">
              <pre class="src src-sh">
: ${<span style="color: #BA36A5;">EDITOR</span>:=<span style=
"color: #FF4700;">"emacsclient"</span>}
<span style="color: #006FE0;">which</span> <span style=
"color: #FF4700;">"$EDITOR"</span> &gt; /dev/null 2&gt;&amp;1 || die <span style="color: #FF4700;">"editor not found"</span>
</pre>
            </div>
          </div>
        </div>

        <div id="outline-container-sec-2-1-9" class="outline-4">
          <h4 id="sec-2-1-9"><span class="section-number-4">2.1.9</span>
          Display changed files</h4>

          <div class="outline-text-4" id="text-2-1-9">
            <p>Shows what files have been modified in your working copy, what
            files have been changed in the repository since your last update,
            and which files, if any, conflict with your modifications. The
            <code>-u</code> option is what forces the command to access the
            repository for this check.</p>

            <div class="org-src-container">
              <pre class="src src-sh">
cecho <span style="color: #FF4700;">"\nChanged files (to be committed):"</span>
<span style="color: #0000FF;">case</span> $<span style=
"color: #BA36A5;">vcs</span><span style="color: #0000FF;"> in</span>
    svn)
        ${<span style="color: #BA36A5;">VCS_STATUS</span>} -u $<span style=
"color: #BA36A5;">@</span> | grep -E -v <span style=
"color: #FF4700;">"^\? "</span> | tee $<span style=
"color: #BA36A5;">tmpfile</span>
        cat $<span style=
"color: #BA36A5;">tmpfile</span> | cut -c 1-9 | grep -E <span style=
"color: #FF4700;">"^M       \*"</span> <span style="color: #FF4700;">\</span>
            &amp;&amp; die <span style=
"color: #FF4700;">"a newer revision exists on the server"</span>
        cat $<span style=
"color: #BA36A5;">tmpfile</span> | cut -c 1-9 | grep -E <span style=
"color: #FF4700;">"^C"</span> &amp;&amp; die <span style=
"color: #FF4700;">"conflicted item modification"</span>
        ;;
    tfs)
        <span style="color: #006FE0;">export</span> <span style=
"color: #BA36A5;">rootdirwin</span>=$(cygpath -w -l <span style=
"color: #FF4700;">"$(pwd)"</span>)
        <span style="color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">printf "Root directory (in Windows format) : $rootdirwin\n"</span>
        ${<span style="color: #BA36A5;">VCS_STATUS</span>} $<span style=
"color: #BA36A5;">@</span> &gt; $<span style="color: #BA36A5;">tmpfile</span>
        <span style="color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">No idea why, but we can't directly pipe the output of `tf status'</span>
        <span style="color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">command</span>
        cat $<span style=
"color: #BA36A5;">tmpfile</span> | grep -F -i <span style=
"color: #FF4700;">"$rootdirwin"</span> | tee $<span style=
"color: #BA36A5;">tmpfile</span>.out
        mv $<span style="color: #BA36A5;">tmpfile</span>.out $<span style=
"color: #BA36A5;">tmpfile</span>
        ;;
<span style="color: #0000FF;">esac</span>
</pre>
            </div>
          </div>
        </div>

        <div id="outline-container-sec-2-1-10" class="outline-4">
          <h4 id="sec-2-1-10"><span class="section-number-4">2.1.10</span>
          Display ignored files</h4>

          <div class="outline-text-4" id="text-2-1-10">
            <div class="org-src-container">
              <pre class="src src-sh">
<span style="color: #0000FF;">case</span> $<span style=
"color: #BA36A5;">vcs</span><span style="color: #0000FF;"> in</span>
    svn)
        cecho <span style="color: #FF4700;">"\nUntracked files:"</span>
        ${<span style="color: #BA36A5;">VCS_STATUS</span>} $<span style=
"color: #BA36A5;">@</span> | grep -E <span style=
"color: #FF4700;">"^\? "</span> | grep -v <span style=
"color: #FF4700;">" 0.*-"</span>
        ;;
    tfs)
        ;;
<span style="color: #0000FF;">esac</span>
</pre>
            </div>

            <p>Stop if no changes are to be committed. Though, that may mean
            that you should <code>add</code> some of the files currently
            ignored; hence, it’s good to make this check after having sent some
            information to the user…</p>

            <div class="org-src-container">
              <pre class="src src-sh">
[[ $(cat $<span style=
"color: #BA36A5;">tmpfile</span> | wc -l) -gt 0 ]] <span style=
"color: #FF4700;">\</span>
    || die <span style=
"color: #FF4700;">"no changes to send to the repository"</span>
</pre>
            </div>
          </div>
        </div>

        <div id="outline-container-sec-2-1-11" class="outline-4">
          <h4 id="sec-2-1-11"><span class="section-number-4">2.1.11</span> Ask
          for short log message</h4>

          <div class="outline-text-4" id="text-2-1-11">
            <div class="org-src-container">
              <pre class="src src-sh">
<span style="color: #0000FF;">if</span> [[ <span style=
"color: #FF4700;">"$asksubject"</span> != <span style=
"color: #FF4700;">"no"</span> ]]; <span style="color: #0000FF;">then</span>
    printf <span style="color: #FF4700;">"\nSubject (short log): "</span>
    <span style="color: #006FE0;">read</span> subject
<span style="color: #0000FF;">fi</span>
</pre>
            </div>
          </div>
        </div>

        <div id="outline-container-sec-2-1-12" class="outline-4">
          <h4 id="sec-2-1-12"><span class="section-number-4">2.1.12</span>
          Generate name for patch files</h4>

          <div class="outline-text-4" id="text-2-1-12">
            <div class="org-src-container">
              <pre class="src src-sh">
<span style="color: #BA36A5;">oldcounter</span>=$(ls ${<span style=
"color: #BA36A5;">patchfileprefix</span>}0???-*.patch 2&gt; /dev/null | sort --reverse <span style="color: #FF4700;">\</span>
    | head -n 1 | sed <span style=
"color: #FF4700;">"s/^${patchfileprefix}00*//"</span> | cut -d <span style=
"color: #FF4700;">"-"</span> -f 1)
<span style="color: #BA36A5;">newcounterpadded</span>=$(printf <span style=
"color: #FF4700;">"%04d"</span> <span style=
"color: #FF4700;">"$(( oldcounter + 1 ))"</span>)
<span style="color: #BA36A5;">filename</span>=<span style=
"color: #FF4700;">"$newcounterpadded-$(printf "$subject\n" | tr '[:upper:]' '[:lower:]' | sed 's/[^a-z0-9]/-/g')"</span>

<span style="color: #BA36A5;">patch</span>=${<span style=
"color: #BA36A5;">patchfileprefix</span>}${<span style=
"color: #BA36A5;">filename</span>}.patch
<span style="color: #BA36A5;">commitmsg</span>=${<span style=
"color: #BA36A5;">commitmsgfileprefix</span>}${<span style=
"color: #BA36A5;">filename</span>}.log
<span style="color: #BA36A5;">email</span>=${<span style=
"color: #BA36A5;">emailfileprefix</span>}${<span style=
"color: #BA36A5;">filename</span>}.txt
</pre>
            </div>
          </div>
        </div>

        <div id="outline-container-sec-2-1-13" class="outline-4">
          <h4 id="sec-2-1-13"><span class="section-number-4">2.1.13</span> Make
          patch file</h4>

          <div class="outline-text-4" id="text-2-1-13">
            <p>The patch file generated only reports <code>file.bin: files
            differ</code>. The fix for getting such names included in the log
            (list of modified files) is to replace that one-sentence with a
            traditional <code>Index:</code> marker.</p>

            <div class="org-src-container">
              <pre class="src src-sh">
makediff $<span style=
"color: #BA36A5;">@</span> | fixtfsbinaryfiles &gt; $<span style=
"color: #BA36A5;">patch</span>
</pre>
            </div>

            <p><code>excludefileregexp</code> allows one to exclude useless or
            unreadable diffs from the email contents. That does not have any
            impact on the commit process itself…</p>

            <div class="org-src-container">
              <pre class="src src-sh">
<span style="color: #0000FF;">if</span> [[ -n <span style=
"color: #FF4700;">"$excludefileregexp"</span> ]]; <span style=
"color: #0000FF;">then</span>
    cat $<span style="color: #BA36A5;">patch</span> |<span style=
"color: #FF4700;">\</span>
    awk -v <span style="color: #BA36A5;">pattern</span>=<span style=
"color: #FF4700;">"^Index: .*$excludefileregexp"</span> <span style=
"color: #FF4700;">\</span>
        <span style="color: #FF4700;">'BEGIN {deleteline = 0;}</span>
<span style=
"color: #FF4700;">         $0 ~ pattern {deleteline = 1; next;}</span>
<span style=
"color: #FF4700;">         // &amp;&amp; deleteline == 0 {print $0;}</span>
<span style=
"color: #FF4700;">         /^Index: / &amp;&amp; deleteline == 1 {print $0; deleteline = 0;}'</span> <span style="color: #FF4700;">\</span>
    &gt; $<span style="color: #BA36A5;">patch</span>.excluded 2&gt; /dev/null
<span style="color: #0000FF;">else</span>
    cp $<span style="color: #BA36A5;">patch</span> $<span style=
"color: #BA36A5;">patch</span>.excluded
<span style="color: #0000FF;">fi</span>
</pre>
            </div>
          </div>
        </div>

        <div id="outline-container-sec-2-1-14" class="outline-4">
          <h4 id="sec-2-1-14"><span class="section-number-4">2.1.14</span> Edit
          log message</h4>

          <div class="outline-text-4" id="text-2-1-14">
            <div class="org-src-container">
              <pre class="src src-sh">
<span style="color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">ask for commit message</span>
cat &lt;&lt;EOF &gt; $<span style="color: #BA36A5;">email</span>
<span style=
"color: #0000ff; background-color: #EEF5FE;"># Hey, Emacs! This is a -*- Diff -*- file</span>
<span style=
"color: #0000ff; background-color: #EEF5FE;"># Please enter the commit message for your changes. Lines starting</span>
<span style=
"color: #0000ff; background-color: #EEF5FE;"># with '#' will be ignored...</span>
<span style=
"color: #0000ff; background-color: #EEF5FE;"># The FIRST LINE of the commit message should be a short description</span>
<span style=
"color: #0000ff; background-color: #EEF5FE;"># and should skip the full stop. It will become the subject of the email.</span>
<span style="color: #0000ff; background-color: #EEF5FE;">EOF</span>
<span style="color: #0000FF;">case</span> $<span style=
"color: #BA36A5;">vcs</span><span style="color: #0000FF;"> in</span>
    svn)
        <span style="color: #BA36A5;">makelogparams</span>=<span style=
"color: #FF4700;">"$*"</span>
        ;;
    tfs)
        <span style="color: #BA36A5;">makelogparams</span>=<span style=
"color: #FF4700;">"-f $patch"</span>
        ;;
<span style="color: #0000FF;">esac</span>
{ printf <span style=
"color: #FF4700;">"$subject\n"</span>; makelog $<span style=
"color: #BA36A5;">makelogparams</span> | sort | uniq; printf <span style=
"color: #FF4700;">"\n---\n"</span>; printf <span style=
"color: #FF4700;">"$url\n\n"</span>; <span style="color: #FF4700;">\</span>
  cat $<span style=
"color: #BA36A5;">patch</span>.excluded; } &gt;&gt; $<span style=
"color: #BA36A5;">email</span>
mv $<span style="color: #BA36A5;">patch</span>.excluded $<span style=
"color: #BA36A5;">patch</span>
printf <span style=
"color: #FF4700;">"\nEdit commit log message and email to send to '$mailto'...\n"</span>
<span style="color: #FF4700;">"$EDITOR"</span> $<span style=
"color: #BA36A5;">email</span>
test $<span style="color: #BA36A5;">?</span> -eq 0 || die <span style=
"color: #FF4700;">"edit failed"</span>

<span style="color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">remove comments from editable part</span>
sed <span style=
"color: #FF4700;">'0,/^---$/{/^#[^+].*$/d;}'</span> &lt; $<span style=
"color: #BA36A5;">email</span> &gt; $<span style=
"color: #BA36A5;">email</span>.nocomment; mv $<span style=
"color: #BA36A5;">email</span>.nocomment $<span style=
"color: #BA36A5;">email</span>
</pre>
            </div>
          </div>
        </div>

        <div id="outline-container-sec-2-1-15" class="outline-4">
          <h4 id="sec-2-1-15"><span class="section-number-4">2.1.15</span>
          Convert email contents into UTF-8</h4>

          <div class="outline-text-4" id="text-2-1-15">
            <div class="org-src-container">
              <pre class="src src-sh">
<span style="color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">convert email into UTF-8</span>
<span style="color: #0000FF;">case</span> <span style=
"color: #FF4700;">"$(file --brief $email 2&gt; /dev/null | sed 's/unified diff output, //')"</span><span style="color: #0000FF;"> in</span>
    UTF-8*)
        ;;
    ASCII*)
        ;;
    ISO-8859*)
        printf <span style=
"color: #FF4700;">"Character encoding of diff output: ISO-8859... Converting it to UTF-8...\n"</span>
        cat $<span style=
"color: #BA36A5;">email</span> | iconv -c -f ISO-8859-1 -t UTF-8 &gt; $<span style="color: #BA36A5;">tmpfile</span>
        mv $<span style="color: #BA36A5;">tmpfile</span> $<span style=
"color: #BA36A5;">email</span>
        ;;
    *)
        printf <span style=
"color: #FF4700;">"Potential problems found in email file $email: $(file --brief $email)\n"</span>
        ask <span style=
"color: #FF4700;">"Continue?"</span> || die <span style="color: #FF4700;">"exiting..."</span>
        ;;
<span style="color: #0000FF;">esac</span>
printf <span style="color: #FF4700;">"Email:         $email\n"</span>
</pre>
            </div>
          </div>
        </div>

        <div id="outline-container-sec-2-1-16" class="outline-4">
          <h4 id="sec-2-1-16"><span class="section-number-4">2.1.16</span>
          Deduce log message for commit</h4>

          <div class="outline-text-4" id="text-2-1-16">
            <div class="org-src-container">
              <pre class="src src-sh">
sed <span style="color: #FF4700;">'/^---$/,$d'</span> &lt; $<span style=
"color: #BA36A5;">email</span> &gt; $<span style=
"color: #BA36A5;">commitmsg</span>
</pre>
            </div>
          </div>
        </div>

        <div id="outline-container-sec-2-1-17" class="outline-4">
          <h4 id="sec-2-1-17"><span class="section-number-4">2.1.17</span>
          Deduce subject line for email</h4>

          <div class="outline-text-4" id="text-2-1-17">
            <div class="org-src-container">
              <pre class="src src-sh">
<span style="color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">get new subject for email (first line of log message)</span>
head -n 1 $<span style="color: #BA36A5;">email</span> &gt; $<span style=
"color: #BA36A5;">tmpfile</span>

<span style="color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">replace accented letters by their unaccented equivalent</span>
<span style="color: #0000FF;">case</span> <span style=
"color: #FF4700;">"$(file --brief $tmpfile 2&gt; /dev/null)"</span><span style=
"color: #0000FF;"> in</span>
    UTF-8*)
        <span style="color: #BA36A5;">subject</span>=<span style=
"color: #FF4700;">"$(cat $tmpfile | iconv -c -f UTF-8 -t ISO-8859-1 | unaccent)"</span>
        ;;
    ISO-8859*|ASCII*)
        <span style="color: #BA36A5;">subject</span>=<span style=
"color: #FF4700;">"$(cat $tmpfile | unaccent)"</span>
        ;;
    *)
        die <span style=
"color: #FF4700;">"unknown character encoding: $(file --brief $tmpfile). Did you put the subject as first line?"</span>
        ;;
<span style="color: #0000FF;">esac</span>
</pre>
            </div>
          </div>
        </div>

        <div id="outline-container-sec-2-1-18" class="outline-4">
          <h4 id="sec-2-1-18"><span class="section-number-4">2.1.18</span>
          Auto-commit changes</h4>

          <div class="outline-text-4" id="text-2-1-18">
            <div class="org-src-container">
              <pre class="src src-sh">
printf <span style="color: #FF4700;">"\n"</span>
<span style="color: #0000FF;">if</span> [[ <span style=
"color: #FF4700;">"$autocommit"</span> = <span style=
"color: #FF4700;">"ask"</span> ]]; <span style="color: #0000FF;">then</span>
    ask <span style="color: #FF4700;">"Commit?"</span> &amp;&amp; <span style=
"color: #BA36A5;">askcommit</span>=<span style=
"color: #FF4700;">"yes"</span> || <span style=
"color: #BA36A5;">askcommit</span>=<span style="color: #FF4700;">"no"</span>
<span style="color: #0000FF;">fi</span>

<span style="color: #0000FF;">if</span> [[ <span style=
"color: #FF4700;">"$autocommit"</span> = <span style=
"color: #FF4700;">"yes"</span> || <span style=
"color: #FF4700;">"$askcommit"</span> = <span style=
"color: #FF4700;">"yes"</span> ]]; <span style="color: #0000FF;">then</span>
    printf <span style="color: #FF4700;">"Committing...\n"</span>
    <span style="color: #0000FF;">case</span> $<span style=
"color: #BA36A5;">vcs</span><span style="color: #0000FF;"> in</span>
        svn)
            svn commit --file $<span style=
"color: #BA36A5;">commitmsg</span> $<span style="color: #BA36A5;">@</span>
            ;;
        tfs)
            tf checkin /comment:@$<span style=
"color: #BA36A5;">commitmsg</span> /noprompt $<span style=
"color: #BA36A5;">@</span>
            ;;
    <span style="color: #0000FF;">esac</span>
    <span style="color: #BA36A5;">rc</span>=$<span style=
"color: #BA36A5;">?</span>
<span style="color: #0000FF;">else</span>
    printf <span style="color: #FF4700;">"Nothing gets committed...\n"</span>
    <span style="color: #BA36A5;">rc</span>=0
<span style="color: #0000FF;">fi</span>
test $<span style="color: #BA36A5;">rc</span> -eq 0 || die <span style=
"color: #FF4700;">"commit failed"</span>
</pre>
            </div>
          </div>
        </div>

        <div id="outline-container-sec-2-1-19" class="outline-4">
          <h4 id="sec-2-1-19"><span class="section-number-4">2.1.19</span>
          Auto-send email</h4>

          <div class="outline-text-4" id="text-2-1-19">
            <div class="org-src-container">
              <pre class="src src-sh">
printf <span style="color: #FF4700;">"\n"</span>
<span style="color: #0000FF;">if</span> [[ <span style=
"color: #FF4700;">"$autosendemail"</span> = <span style=
"color: #FF4700;">"ask"</span> ]]; <span style="color: #0000FF;">then</span>
    printf <span style=
"color: #FF4700;">"Environment for sending email:\n"</span>
    <span style="color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">print the email command</span>
    printf <span style="color: #FF4700;">"$emailcommand\n"</span>
    [[ -f $<span style=
"color: #BA36A5;">userconfig</span> ]] &amp;&amp; grep <span style=
"color: #FF4700;">"excludefileregexp"</span> $<span style=
"color: #BA36A5;">userconfig</span>
    [[ -f $<span style=
"color: #BA36A5;">projectconfig</span> ]] &amp;&amp; grep <span style=
"color: #FF4700;">"excludefileregexp"</span> $<span style=
"color: #BA36A5;">projectconfig</span>
    [[ -f $<span style=
"color: #BA36A5;">userprojectconfig</span> ]] &amp;&amp; grep <span style=
"color: #FF4700;">"excludefileregexp"</span> $<span style=
"color: #BA36A5;">userprojectconfig</span>
    ask <span style=
"color: #FF4700;">"Send email?"</span> &amp;&amp; <span style=
"color: #BA36A5;">asksendemail</span>=<span style=
"color: #FF4700;">"yes"</span> || <span style=
"color: #BA36A5;">asksendemail</span>=<span style="color: #FF4700;">"no"</span>
<span style="color: #0000FF;">fi</span>

<span style="color: #0000FF;">if</span> [[ <span style=
"color: #FF4700;">"$autosendemail"</span> = <span style=
"color: #FF4700;">"yes"</span> || <span style=
"color: #FF4700;">"$asksendemail"</span> = <span style=
"color: #FF4700;">"yes"</span> ]]; <span style="color: #0000FF;">then</span>
    printf <span style="color: #FF4700;">"Sending email...\n"</span>
    <span style="color: #006FE0;">eval</span> <span style=
"color: #FF4700;">"$emailcommand"</span>
    <span style="color: #BA36A5;">rc</span>=$<span style=
"color: #BA36A5;">?</span>
<span style="color: #0000FF;">else</span>
    printf <span style="color: #FF4700;">"Nothing gets sent...\n"</span>
    <span style="color: #BA36A5;">rc</span>=0
<span style="color: #0000FF;">fi</span>
test $<span style="color: #BA36A5;">rc</span> -eq 0 || die <span style=
"color: #FF4700;">"send email failed"</span>
</pre>
            </div>
          </div>
        </div>

        <div id="outline-container-sec-2-1-20" class="outline-4">
          <h4 id="sec-2-1-20"><span class="section-number-4">2.1.20</span>
          Auto-delete temporary files</h4>

          <div class="outline-text-4" id="text-2-1-20">
            <div class="org-src-container">
              <pre class="src src-sh">
printf <span style="color: #FF4700;">"\n"</span>
<span style="color: #0000FF;">if</span> [[ <span style=
"color: #FF4700;">"$autodeletetmpfiles"</span> = <span style=
"color: #FF4700;">"ask"</span> ]]; <span style="color: #0000FF;">then</span>
    ask <span style=
"color: #FF4700;">"Delete temp files?"</span> &amp;&amp; <span style=
"color: #BA36A5;">askdeletetmpfiles</span>=<span style=
"color: #FF4700;">"yes"</span> || <span style=
"color: #BA36A5;">askdeletetmpfiles</span>=<span style=
"color: #FF4700;">"no"</span>
<span style="color: #0000FF;">fi</span>

<span style="color: #0000FF;">if</span> [[ <span style=
"color: #FF4700;">"$autodeletetmpfiles"</span> = <span style=
"color: #FF4700;">"yes"</span> || <span style=
"color: #FF4700;">"$askdeletetmpfiles"</span> = <span style=
"color: #FF4700;">"yes"</span> ]]; <span style="color: #0000FF;">then</span>
    printf <span style="color: #FF4700;">"Deleting temp files...\n"</span>
    rm $<span style="color: #BA36A5;">patch</span> $<span style=
"color: #BA36A5;">commitmsg</span> $<span style="color: #BA36A5;">email</span>
    <span style="color: #BA36A5;">rc</span>=$<span style=
"color: #BA36A5;">?</span>
<span style="color: #0000FF;">else</span>
    printf <span style="color: #FF4700;">"Nothing gets deleted...\n"</span>
    <span style="color: #BA36A5;">rc</span>=0
<span style="color: #0000FF;">fi</span>
test $<span style="color: #BA36A5;">rc</span> -eq 0 || die <span style=
"color: #FF4700;">"delete temp files failed"</span>

<span style="color: #008200;">## </span><span style=
"color: #008200; font-style: italic;">sendpatch ends here</span>
</pre>
            </div>
          </div>
        </div>
      </div>

      <div id="outline-container-sec-2-2" class="outline-3">
        <h3 id="sec-2-2"><span class="section-number-3">2.2</span> Display list
        of files</h3>

        <div class="outline-text-3" id="text-2-2">
          <p>Display a list of files to be committed, for the commit log
          message.</p>

          <div class="org-src-container">
            <pre class="src src-sh">
<span style="color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">Usage: makelog [-f diff-file] [svn diff options]</span>
<span style="color: #008200;">#</span>
<span style="color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">Make a log message for a change, including the header, and the relative</span>
<span style="color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">pathnames of the changed files. Output goes to stdout.</span>
<span style="color: #008200;">#</span>
<span style="color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">If a you have a pre-existing diff file, use `-f diff-file' to use this file.</span>

printf <span style="color: #FF4700;">"\n"</span>

{ <span style="color: #0000FF;">if</span> [ <span style=
"color: #FF4700;">"$1"</span> = <span style="color: #FF4700;">"-f"</span> ]
<span style="color: #0000FF;">then</span>
    cat $<span style="color: #BA36A5;">2</span>
<span style="color: #0000FF;">else</span>
    svn diff -x -w --no-diff-deleted --show-copies-as-adds $<span style=
"color: #BA36A5;">*</span> 2&gt;&amp;1
<span style="color: #0000FF;">fi</span>; } | sed <span style=
"color: #FF4700;">'/^Index:/!d'</span> | sed <span style=
"color: #FF4700;">'s/^Index: /  * /'</span> | sed <span style=
"color: #FF4700;">'s/$/:/'</span>
</pre>
          </div>

          <p>With the option <code>--show-copies-as-adds</code>, copied (and
          moved) files are listed.</p>

          <p>Using =sed ‘<i>^Index:</i>!d’= (instead of =egrep “^Index:"=)
          allows to filter the lines we’re interested in, even if the file
          contains binary characters (such as non-breakable spaces). On the
          other hand, <code>grep</code> would simply declare that “Binary file
          matches”.</p>
        </div>
      </div>

      <div id="outline-container-sec-2-3" class="outline-3">
        <h3 id="sec-2-3"><span class="section-number-3">2.3</span> Display
        changes</h3>

        <div class="outline-text-3" id="text-2-3">
          <p>Display the changes made to all target files, and display deleted
          and new files as well.</p>

          <p>With the option <code>-x -w</code>, <code>svn diff</code> <b>shows
          only non-whitespace line changes</b> between two revisions.</p>

          <p>With the option <code>--no-diff-deleted</code>, differences for
          deleted files are not printed.</p>

          <div class="org-src-container">
            <pre class="src src-sh">
<span style="color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">Usage: makediff [svn diff options]</span>
<span style="color: #008200;">#</span>
<span style="color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">Make a diff file, ready for review. It contains the diffs of all files,</span>
<span style="color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">followed by the text of new files. Output goes to stdout.</span>

<span style="color: #BA36A5;">tmpfile</span>=<span style=
"color: #FF4700;">"/tmp/$(basename $0).$$"</span>
<span style="color: #0000FF;">trap</span> <span style=
"color: #FF4700;">"rm -f $tmpfile"</span> EXIT SIGHUP SIGINT SIGQUIT SIGTERM

<span style="color: #0000FF;">case</span> $<span style=
"color: #BA36A5;">vcs</span><span style="color: #0000FF;"> in</span>
    svn)
        svn diff -x -w --no-diff-deleted $<span style=
"color: #BA36A5;">*</span> &gt; $<span style=
"color: #BA36A5;">tmpfile</span> 2&gt;&amp;1
        ;;
    tfs)
        tf diff $<span style=
"color: #BA36A5;">*</span> /format:Unified &gt; $<span style=
"color: #BA36A5;">tmpfile</span> 2&gt;&amp;1
        cat $<span style="color: #BA36A5;">tmpfile</span> <span style=
"color: #FF4700;">\</span>
            | grep -E -i -v <span style=
"color: #FF4700;">"^(edit|modifier|add|ajouter|renommer): "</span> <span style=
"color: #FF4700;">\</span>
            | sed -r <span style=
"color: #FF4700;">"s/^(File:|Fichier\o240:)/Index:/"</span> &gt; $<span style=
"color: #BA36A5;">tmpfile</span>.out
        mv $<span style="color: #BA36A5;">tmpfile</span>.out $<span style=
"color: #BA36A5;">tmpfile</span>
        ;;
<span style="color: #0000FF;">esac</span>
cat $<span style="color: #BA36A5;">tmpfile</span>
</pre>
          </div>
        </div>
      </div>

      <div id="outline-container-sec-2-4" class="outline-3">
        <h3 id="sec-2-4"><span class="section-number-3">2.4</span> Ignore files
        from the command line</h3>

        <div class="outline-text-3" id="text-2-4">
          <p>Add a file (or a file glob pattern) to ignore without deleting the
          previous value of the <code>svn:ignore</code> property… from the
          command line.</p>

          <div class="org-src-container">
            <pre class="src src-sh">
<span style="color: #008200;"># </span><span style=
"color: #008200; font-style: italic;">Usage: svnignore admin/notes/\*.tex</span>

<span style="color: #BA36A5;">target</span>=<span style=
"color: #FF4700;">"$1"</span>
<span style="color: #BA36A5;">targetdirectory</span>=$(dirname $<span style=
"color: #BA36A5;">target</span>)
<span style="color: #BA36A5;">targetfilepattern</span>=$(basename $<span style=
"color: #BA36A5;">target</span>)

<span style=
"color: #BA36A5;">svnignores</span>=$(svn propget svn:ignore <span style=
"color: #FF4700;">"$targetdirectory"</span>)
<span style="color: #BA36A5;">svnignores</span>=<span style=
"color: #FF4700;">"$svnignores"</span>$<span style=
"color: #FF4700;">'\n'"$targetfilepattern"</span>
printf <span style="color: #FF4700;">"Ignore '$targetfilepattern'\n"</span>
svn propset svn:ignore <span style=
"color: #FF4700;">"$svnignores"</span> <span style=
"color: #FF4700;">"$targetdirectory"</span>
</pre>
          </div>
        </div>
      </div>

      <div id="outline-container-sec-2-5" class="outline-3">
        <h3 id="sec-2-5"><span class="section-number-3">2.5</span>
        Unaccent</h3>

        <div class="outline-text-3" id="text-2-5">
          <p>Remove accents, replacing accented letters by their unaccented
          equivalent.</p>

          <div class="org-src-container">
            <pre class="src src-sh">
s/\o240/ /g
s/\o300/A/g
s/\o301/A/g
s/\o302/A/g
s/\o304/A/g
s/\o310/E/g
s/\o311/E/g
s/\o312/E/g
s/\o313/E/g
s/\o315/I/g
s/\o316/I/g
s/\o323/O/g
s/\o324/O/g
s/\o325/O/g
s/\o326/O/g
s/\o331/U/g
s/\o332/U/g
s/\o333/U/g
s/\o334/U/g
s/\o340/a/g
s/\o341/a/g
s/\o342/a/g
s/\o344/a/g
s/\o347/c/g
s/\o350/e/g
s/\o351/e/g
s/\o352/e/g
s/\o353/e/g
s/\o355/i/g
s/\o356/i/g
s/\o357/i/g
s/\o363/o/g
s/\o364/o/g
s/\o365/o/g
s/\o366/o/g
s/\o371/u/g
s/\o372/u/g
s/\o373/u/g
s/\o374/u/g
</pre>
          </div>
        </div>
      </div>

      <div id="outline-container-sec-2-6" class="outline-3">
        <h3 id="sec-2-6"><span class="section-number-3">2.6</span> Install
        environment</h3>

        <div class="outline-text-3" id="text-2-6">
          <p>Symlink the files.</p>

          <div class="org-src-container">
            <pre class="src src-sh">
ln -f -s $(<span style="color: #006FE0;">pwd</span>)/sendpatch ~/bin/sendpatch
ln -f -s $(<span style="color: #006FE0;">pwd</span>)/makelog   ~/bin/makelog
ln -f -s $(<span style="color: #006FE0;">pwd</span>)/makediff  ~/bin/makediff
ln -f -s $(<span style="color: #006FE0;">pwd</span>)/svnignore ~/bin/svnignore
ln -f -s $(<span style="color: #006FE0;">pwd</span>)/unaccent  ~/bin/unaccent
</pre>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="postamble" class="status">
    <div id="copyright">
      © Fabrice Niessen
    </div>
  </div>
</body>
</html>
